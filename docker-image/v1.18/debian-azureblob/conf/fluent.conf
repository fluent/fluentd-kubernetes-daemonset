
# AUTOMATICALLY GENERATED
# DO NOT EDIT THIS FILE DIRECTLY, USE /templates/conf/fluent.conf.erb

@include "#{ENV['FLUENTD_SYSTEMD_CONF'] || 'systemd'}.conf"
@include "#{ENV['FLUENTD_PROMETHEUS_CONF'] || 'prometheus'}.conf"
@include kubernetes.conf
@include conf.d/*.conf

<match **>
  @type azure-storage-append-blob
  @id out_azure_storage_append_blob

  azure_cloud                     "#{ENV['AZUREBLOB_AZURE_CLOUD']}"
  azure_storage_account           "#{ENV['AZUREBLOB_ACCOUNT_NAME']}"
  azure_storage_access_key        "#{ENV['AZUREBLOB_ACCOUNT_KEY']}"
  azure_storage_connection_string "#{ENV['AZUREBLOB_CONNECTION_STRING']}"
  azure_storage_sas_token         "#{ENV['AZUREBLOB_SAS_TOKEN']}"
  azure_container                 "#{ENV['AZUREBLOB_CONTAINER']}"
  azure_imds_api_version          "#{ENV['AZUREBLOB_IMDS_API_VERSION']}"
  azure_token_refresh_interval    "#{ENV['AZUREBLOB_TOKEN_REFRESH_INTERVAL']}"
  auto_create_container           true
  path                            "#{ENV['AZUREBLOB_LOG_PATH']}"
  azure_object_key_format         %{path}%{time_slice}_%{index}.log
  time_slice_format               %Y%m%d-%H
  # if you want to use %{tag} or %Y/%m/%d/ like syntax in path / azure_blob_name_format,
  # need to specify tag for %{tag} and time for %Y/%m/%d in <buffer> argument.
  <buffer>
    @type file
    path /var/log/fluent/azurestorageappendblob
    timekey 60 # 1 minute
    timekey_wait 60
    timekey_use_utc true # use utc
    chunk_limit_size 256m
  </buffer>
</match>
